<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/3.8.2/superagent.js"></script>
    <script src="calendar.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { Component } = React;
      const { render } = ReactDOM;

      class Inputs extends Component {
        constructor(props) {
          super(props);
          this.state = {
            startdate: null,
            countrycode: null,
            days: null
          };
          this.onChange = this.onChange.bind(this);
          this.onClick = this.onClick.bind(this);
        }

        onClick(e) {
          if (this.props.onSearch) {
            this.props.onSearch(this.state)
          } else {
            console.log('Click!');
          }
        }

        onChange({ target }) {
          this.setState({ [target.name]: target.value });
        }

        render() {
          return (
            <div className={'inputs'}>
              <input
                type={'date'}
                name={'startdate'}
                onChange={this.onChange} />
              <br />
              <input
                type={'text'}
                name={'countrycode'}
                placeholder={'Country Code'}
                onChange={this.onChange} />
              <br />
              <input
                type={'number'}
                name={'days'}
                min={1}
                placeholder={'Days'}
                onChange={this.onChange} />
              <br />
              <input type={'button'} name={'inputs'} value={'Filter'} onClick={this.onClick} />
            </div>
          );
        }
      }

      class App extends Component {
        constructor(props) {
          // Initial props:
          super(props);

          // Initial state:
          this.state = {
            filters: null,
            api: {
              url: `https://holidayapi.com/v1/holidays`,
              query: {
                key: `927457cd-2748-43a6-9991-a3c0925d3092`,
                country: `US`,
                year: `2008`,
                month: `9`
              }
            },
            calendar: null
          };

          // Event handlers:
          this.onSearch = this.onSearch.bind(this);
        }

        async onSearch(values) {
          let state = this.state;

          state.filters = Object.assign({}, values);

          if (/\-0/g.test(state.filters.startdate)) { // -0n
            let date = state.filters.startdate.replace(/\-0/g, '-'); // 2017-01-01 -> 2017-1-1
            state.filters.startdate = new Date(date);
            state.api.query.country = state.filters.countrycode;
            state.api.query.year    = state.filters.startdate.getFullYear();
            state.api.query.month   = state.filters.startdate.getMonth() + 1;
          }

          try {
            const { body } = await superagent(state.api.url).query(state.api.query);
            state.calendar = new Calendario(state.api.query.year);

            console.log('getMonthsFrom a year ---->', state.calendar.getMonthsFrom(state.api.query.year));

            if (body.holidays.length) {
              console.log(`The month has: ${body.holidays.length} holidays`);
            }
          } catch ({ message }) {
            console.log('ERROR HERE! ->', message);
          }

          console.log('State:', state);

          this.setState(state);
        }

        render() {
          return (
            <div className={'wrapper'}>
              <h1>Hello from react</h1>
              <Inputs onSearch={this.onSearch} />
            </div>
          );
        }
      }

      render(<App />, document.getElementById('root'));
    </script>
  </body>
</html>
